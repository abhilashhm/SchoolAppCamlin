<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>
        Home Page
    </title>

    <link rel="stylesheet" href="css/landing.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif|Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://s3-us-west-2.amazonaws.com/s.cdpn.io/148866/reset.css">
    <link rel="stylesheet" href="css/splide.min.css">
    <link rel="stylesheet" href="css/slider.css">

    <script src="js/jquery.min.js"></script>
    <script src="js/splide.min.js" type="text/javascript"></script>
    <script src="js/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"
        type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.25/vue.min.js" type="text/javascript"></script>
    <script async src="https://kit.fontawesome.com/6cc05e1e8e.js" crossorigin="anonymous"></script>    

</head>

<body>

    <div id="loader" class="center"></div>

    <section id="cd-timeline" class="cd-container"></section>

    <div id="navigation-wrapper">
        <div class="navigation">
            <div class="navigation-buttons">
                <ul>
                    <li v-for="nav_item in navigation" v-bind:class="{'selected': nav_item.selected}"
                        v-on:click="selectItem($index)">
                        <i class="material-icons">{{nav_item.icon}}</i>
                        <p>{{nav_item.name}}</p>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const mobno = window.localStorage.getItem('LoggedInMob');

        jQuery(document).ready(function ($) {
            var $timeline_block = $('.cd-timeline-block');

            //hide timeline blocks which are outside the viewport
            $timeline_block.each(function () {
                if ($(this).offset().top > $(window).scrollTop() + $(window).height() * 0.75) {
                    $(this).find('.cd-timeline-img, .cd-timeline-content').addClass('is-hidden');
                }
            });

            //on scolling, show/animate timeline blocks when enter the viewport
            $(window).on('scroll', function () {
                $timeline_block.each(function () {
                    if ($(this).offset().top <= $(window).scrollTop() + $(window).height() * 0.75 && $(this).find('.cd-timeline-img').hasClass('is-hidden')) {
                        $(this).find('.cd-timeline-img, .cd-timeline-content').removeClass('is-hidden').addClass('bounce-in');
                    }
                });
            });
        });

        const url = `http://68.178.168.127/camlinwebservice/getTimeLine/${mobno}`;

        $.ajax({
            type: "GET",
            url: url,
            success: function (xml) {
                console.log(xml);
                //alert(data.documentElement.getElementsByTagName("Response")[0].childNodes[0].nodeValue);

                // let parser = new DOMParser();
                // let xml = parser.parseFromString(data, "text/xml");
                // console.log(xml.getElementsByTagName('Response'));

                if ((xml.getElementsByTagName('Response')[0].childNodes[0].nodeValue).match("FAILED: Mobile number / TimeLine Data not found")) {
                    // alert("Timeline Data not found!");
                    document.getElementById("cd-timeline").innerHTML += "<div class='no-data'>Timeline Data not found!</div>";
                } else {
                    // alert(xml.getElementsByTagName('Message').length);
                    //alert(xml.getElementsByTagName('Title')[0].nodeValue);

                    for (let i = 0; i < xml.getElementsByTagName('Message').length; i++) {
                        document.getElementById("cd-timeline").innerHTML += "<div class='cd-timeline-block'><div class='cd-timeline-img cd-picture'><img src='images/" + xml.getElementsByTagName('CommunicationType')[i].childNodes[0].nodeValue + ".jpg' alt='Picture'></div><div class='cd-timeline-content'><h2>" + window.localStorage.getItem('Name') + " | " + xml.getElementsByTagName('CommunicationType')[i].childNodes[0].nodeValue + "</h2><p>" + xml.getElementsByTagName('Body')[i].childNodes[0].nodeValue + "</p><!--<a href='#0' class='cd-read-more'>Read more</a>--><div class='cd-content'><span class='cd-date'>" + xml.getElementsByTagName('Date')[i].childNodes[0].nodeValue + "</span><span class='cd-time'>" + xml.getElementsByTagName('Time')[i].childNodes[0].nodeValue + "</span><span class='published'>" + xml.getElementsByTagName('PublishedBy')[i].childNodes[0].nodeValue + "</span></div></div></div> " +"<section class='section slider__section'><div class='container slider__wrapper'><div class='slider__column splide'><div class='splide__track'><ul class='splide__list'><li class='splide__slide'><img src='https://source.unsplash.com/1920x1280/?animal' alt='Slider'></li><li class='splide__slide'><img src='https://source.unsplash.com/1920x1280/?nature' alt='Slider'></li><li class='splide__slide'><img src='https://source.unsplash.com/1920x1280/?people' alt='Slider'></li><li class='splide__slide'><img src='https://source.unsplash.com/1920x1280/?flower' alt='Slider'></li><li class='splide__slide'><img src='https://source.unsplash.com/1920x1280/?travel' alt='Slider'></li><li class='splide__slide'><img src='https://source.unsplash.com/1920x1280/?fruits' alt='Slider'></li></ul></div></div></div></section>";
                    }
                }
            },
            error: function (request, status, error) {
                alert(request.responseText);
                alert(status);
                alert(error);
            },
            cache: false
        });
    </script>

    <script>
        $(document).ready(function () {
            setTimeout(function () {
                const splide = new Splide(".splide", {
                    // Optional parameters
                    start: 0,
                    perPage: 1,
                    perMove: 1,
                    gap: 20,
                    type: "loop",
                    drag: "true",
                    snap: true,
                    // interval: 3000,
                    arrows: true,
                    pagination: true,
                    rewind: true,
                    rewindByDrag: true,
                    lazyLoad: true,

                    // Responsive breakpoint
                    breakpoints: {
                        768: {
                            perPage: 1,
                            snap: true
                        }
                    }
                });
                splide.mount();
            }, 100);
        });
    </script>

    <script>
        var app = new Vue({
            el: '#navigation-wrapper',
            data: {
                navigation: [
                    { name: 'HOME', icon: 'home', selected: true },
                    { name: 'CALENDAR', icon: 'calendar_month', selected: false },
                    { name: 'PROFILE', icon: 'account_circle', selected: false }
                ]
            },
            methods: {
                selectItem: function (placement) {
                    for (var i = 0; i < this.navigation.length; i++) {
                        this.navigation[i].selected = false;
                    }
                    this.navigation[placement].selected = true;
                    switch (placement) {
                        case 1:
                            location.href = 'cal.html'
                            break;
                        case 2:
                            location.href = 'profile.html'
                            break;
                    }
                }
            }
        })
    </script>
</body>

</html>